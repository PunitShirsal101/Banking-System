# Global shared configuration applied to all services via Spring Cloud Config

# Observability: expose core endpoints and tracing defaults
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
management.tracing.sampling.probability=0.2
management.otlp.tracing.endpoint=${OTLP_TRACING_ENDPOINT:http://localhost:4317}

# Metrics histograms and SLO-aligned buckets for HTTP server requests
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=50ms,200ms,500ms
# Common metrics tag for all services
management.metrics.tags.application=${spring.application.name}

# WebFlux RFC7807 Problem Details
spring.webflux.problemdetails.enabled=true
# MVC RFC7807 Problem Details
spring.mvc.problemdetails.enabled=true

# Graceful shutdown baseline
server.shutdown=graceful

# Resilience4j defaults (align with requirements)
# TimeLimiter: hard budget for remote calls
resilience4j.timelimiter.instances.default.timeout-duration=300ms

# Circuit Breaker defaults
resilience4j.circuitbreaker.configs.default.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.configs.default.sliding-window-size=50
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=10
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true

# Bulkhead defaults
resilience4j.bulkhead.instances.default.max-concurrent-calls=50
resilience4j.bulkhead.instances.default.max-wait-duration=0

# Rate Limiter defaults (token bucket style)
resilience4j.ratelimiter.instances.default.limit-for-period=50
resilience4j.ratelimiter.instances.default.limit-refresh-period=1s
resilience4j.ratelimiter.instances.default.timeout-duration=0
